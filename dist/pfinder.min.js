(()=>{function S(e,t,n){let i=e[0].length,s=e.length,r=n==0,u=n==s-1,h=t==0,o=t==i-1,a=r||h?1:e[n-1][t-1],M=r?1:e[n-1][t],b=r||o?1:e[n-1][t+1],p=o?1:e[n][t+1],C=u||o?1:e[n+1][t+1],d=u?1:e[n+1][t],l=u||h?1:e[n+1][t-1],g=h?1:e[n][t-1];return[a,M,b,p,C,d,l,g]}var J={right:{a:0,b:1,c:6,d:5,e:3,v:0,h:1},left:{a:2,b:1,c:4,d:5,e:7,v:0,h:-1},up:{a:6,b:7,c:4,d:3,e:1,v:-1,h:0},down:{a:0,b:7,c:2,d:3,e:5,v:1,h:0}},D={rightDown:{a:3,b:4,c:5,v:1,h:1},leftDown:{a:5,b:6,c:7,v:1,h:-1},rightUp:{a:1,b:2,c:3,v:-1,h:1},leftUp:{a:7,b:0,c:1,v:-1,h:-1}};function P(e,t){e.jFlag|=1<<t}function F(e,t,n,i){let s=i,r=S(e,t,n),u=0;if(r[s.e])return{dst:0,isJump:!1};for(;;){if(u++,r=S(e,t+s.h*u,n+s.v*u),r[s.a]&&!r[s.b]||r[s.c]&&!r[s.d])return{dst:u,isJump:!0};if(r[s.e])return{dst:u,isJump:!1}}}function j(e,t,n,i,s){let r=s,u=S(e,n,i),h=0;if(u[r.a]||u[r.b]||u[r.c])return{dst:0,isJump:!1};for(;;){h++,u=S(e,n+r.h*h,i+r.v*h);let o=t[i+r.v*h][n+r.h*h].jump;if((u[r.a]||u[r.b]||u[r.c])&&!o)return{dst:h,isJump:!1};let a=t[i+r.v*h][n+r.h*h].distances;if(o&&(a[r.a]||a[r.c]))return{dst:h,isJump:!0}}}function _(e,t,n,i){let s=e[i][n],r=F(t,n,i,J.up),u=F(t,n,i,J.down),h=F(t,n,i,J.left),o=F(t,n,i,J.right);s.distances[1]=r.dst,s.distances[3]=o.dst,s.distances[5]=u.dst,s.distances[7]=h.dst,r.isJump&&P(s,1),o.isJump&&P(s,3),u.isJump&&P(s,5),h.isJump&&P(s,7)}function x(e,t,n,i){let s=e[i][n],r=j(t,e,n,i,D.leftUp),u=j(t,e,n,i,D.rightUp),h=j(t,e,n,i,D.rightDown),o=j(t,e,n,i,D.leftDown);s.distances[0]=r.dst,s.distances[2]=u.dst,s.distances[4]=h.dst,s.distances[6]=o.dst,r.isJump&&P(s,0),u.isJump&&P(s,2),h.isJump&&P(s,4),o.isJump&&P(s,6)}function y(e,t){return{x:e,y:t,parent:null,distances:[],jFlag:0,jump:!1,inOpen:!1,inClose:!1,g:0,f:0,hash:0}}function v(e,t){return(e.jFlag&1<<t)!=0}function Q(e){let t=e.length,n=e[0].length,i=[];for(let s=0;s<t;s++){let r=new Array(n).fill(0);r.forEach((u,h)=>{r[h]=e[s][h]?0:y(h,s)}),i.push(r)}for(let s=0;s<t;s++)i[s].forEach((u,h)=>{if(!u)return;_(i,e,h,s);let o=i[s][h].distances,a=i[s][h].jFlag;o[1]&&v(u,1)&&(i[s-o[1]][h].jump=!0),o[3]&&v(u,3)&&(i[s][h+o[3]].jump=!0),o[5]&&v(u,5)&&(i[s+o[5]][h].jump=!0),o[7]&&v(u,7)&&(i[s][h-o[7]].jump=!0)});for(let s=0;s<t;s++)i[s].forEach((u,h)=>{u&&x(i,e,h,s)});return i}var A=class{constructor(t){this.items=[],this.prop=t}push(t){if(!this.items.length){t.inOpen=!0,this.items.push(t);return}for(let n=this.items.length-1;n>=0;n--)if(this.items[n][this.prop]>=t[this.prop]){this.items.splice(n+1,0,t);return}this.items.unshift(t)}},k=class{constructor(t,n,i){let s=[];for(let r=0;r<i;r++)s.push(new A(t));this.heaps=s,this.prop=t,this.range=n,this.count=0}addHeaps(t){for(let n=0;n<t;n++)this.heaps.push(new A(this.prop))}push(t){this.count++;let n=t[this.prop]/this.range|0;n>this.heaps.length-1&&this.addHeaps(n-(this.heaps.length-1)),this.heaps[n].push(t)}pop(){if(this.count--,this.count<0)return this.count=0,null;for(let t=0;t<this.heaps.length;t++)if(this.heaps[t].items.length)return this.heaps[t].items.pop()}};var w=0,E=20,I=[],R=[[7,0,1],[7,0,1,2,3],[1,2,3],[1,2,3,4,5],[3,4,5],[3,4,5,6,7],[5,6,7],[5,6,7,0,1]],K=[{v:-1,h:-1},{v:-1,h:0},{v:-1,h:1},{v:0,h:1},{v:1,h:1},{v:1,h:0},{v:1,h:-1},{v:0,h:-1}],tt=[0,1,2,7,null,3,6,5,4];function B(e){let t=[],n=e,i=0;for(;n;)t[i++]={x:n.x,y:n.y},n=n.parent;return t.reverse()}function U(e,t,n){let i=Math.abs(e.x-t),s=Math.abs(e.y-n);return 10*(i+s)-5.857*Math.min(i,s)|0}function et(e,t){let n=t.x-e.x,i=t.y-e.y;if(n<0){if(i<0)return 0;if(i==0)return 7;if(i>0)return 6}if(n==0){if(i<0)return 1;if(i>0)return 5}if(n>0){if(i<0)return 2;if(i==0)return 3;if(i>0)return 4}}function L(e,t,n,i){let s=K[i];return e[t.y+s.v*n][t.x+s.h*n]}function nt(e,t,n){let i=Math.sign(t.x-e.x),s=Math.sign(t.y-e.y);return tt[4+i+3*s]==n}function N(e,t,n,i){let s=t.x,r=t.y;return!!(nt(e,t,n)&&i>=Math.abs(e.x-s)&&i>=Math.abs(e.y-r))}function G(e,t){e.hash=t,e.parent=null,e.inOpen=!1,e.inClose=!1,e.g=0,e.f=0}function q(e,t,n,i,s,r,u){let h=L(e,t,s,r);h.hash!=w&&G(h,w);let o=i.g+u*Math.SQRT2,a=o+s,M=!0;return(h.inClose||h.inOpen&&h.g<=a||t.inOpen&&t.g<=o)&&(M=!1),M?(t.parent=i,t.g=o,t.inOpen=!0,h.parent=t,h.g=a,h.f=a+U(h,n.x,n.y),h.inOpen?null:h):null}function H(e,t,n,i,s){if(!e[n][t]||!e[s][i])return null;let r=[0,1,2,3,4,5,6,7],u=e[s][i],h=new k("f",100,10);w++;let o=e[n][t];for(G(o,w),h.push(o);h.count;){let a=h.pop();if(a.inOpen=!1,a.inClose=!0,a.x==i&&a.y==s)return B(a);let M=a.parent?R[et(a.parent,a)]:r;for(let b=0;b<M.length;b++){let p=M[b],C=K[p],d=a.distances[p];if(d){if(N(a,u,p,d))return u.parent=a,B(u);if(p%2==0){let l=R[p][0],g=R[p][2];for(let m=1;m<=d;m++){let f=e[a.y+C.v*m][a.x+C.h*m],T=f.distances[l],z=f.distances[g];if(f.hash!=w&&G(f,w),m==d&&f.jump){let c=a.g+m*Math.SQRT2;if(f.inClose||f.inOpen&&f.g<=c)continue;f.parent=a,f.g=c,f.f=c+U(f,i,s),f.inOpen||(f.inOpen=!0,f.inClose=!1,h.push(f));continue}if(T){if(N(f,u,l,T))return f.parent=a,u.parent=f,B(u);if(v(f,l)){let c=q(e,f,u,a,T,l,m);c&&(c.inOpen=!0,c.inClose=!1,h.push(c))}}if(z){if(N(f,u,g,z))return f.parent=a,u.parent=f,B(u);if(v(f,g)){let c=q(e,f,u,a,z,g,m);c&&(c.inOpen=!0,c.inClose=!1,h.push(c))}}}}if(p%2!=0&&v(a,p)){let l=L(e,a,d,p);l.hash!=w&&G(l,w);let g=a.g+d;if(l.inClose||l.inOpen&&l.g<=g)continue;l.parent=a,l.g=g,l.f=g+U(l,i,s),l.inOpen||(l.inOpen=!0,l.inClose=!1,h.push(l))}}}}return null}function V(e){e=Math.max(0,e),E=e}function st(){return E}function W(e,t,n,i,s,r){I.push([e,t,n,i,s,r])}function X(){for(let e=0;e<E;e++){let t=I.shift();if(!t)break;let n=H(t[0],t[1],t[2],t[3],t[4]);t[5](n)}}var O=new Map,Y=1e3;function it(e,t,n,i,s){O.size>Y&&O.delete(O.keys().next().value);let r=t+"."+n+"."+i+"."+s;O.set(r,e)}function Z(e,t,n,i,s){if(!e[n][t]||!e[s][i])return null;let r=O.get(t+"."+n+"."+i+"."+s);return r!==void 0||(r=getPath(e,t,n,i,s),it(r,t,n,i,s)),r}function $(e){Y=e}typeof window<"u"&&(globalThis.Pfinder={getPath:H,getPathAsync:W,getPathFromCache:Z,makeGrid:Q,setMaxCacheSize:$,setMaxPathsPerFrame:V,update:X});})();
/**
* @copyright    2023 Juan Jose Capellan
* @license      {@link https://github.com/jjcapellan/pfinder/blob/master/LICENSE | MIT License}
*/
