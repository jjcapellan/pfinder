(()=>{function B(e,t,s){let i=e[0].length,n=e.length,r=s==0,h=s==n-1,u=t==0,l=t==i-1,o=r||u?1:e[s-1][t-1],b=r?1:e[s-1][t],C=r||l?1:e[s-1][t+1],p=l?1:e[s][t+1],M=h||l?1:e[s+1][t+1],d=h?1:e[s+1][t],c=h||u?1:e[s+1][t-1],g=u?1:e[s][t-1];return[o,b,C,p,M,d,c,g]}var D={right:{a:0,b:1,c:6,d:5,e:3,v:0,h:1},left:{a:2,b:1,c:4,d:5,e:7,v:0,h:-1},up:{a:6,b:7,c:4,d:3,e:1,v:-1,h:0},down:{a:0,b:7,c:2,d:3,e:5,v:1,h:0}},P={rightDown:{a:3,b:4,c:5,v:1,h:1},leftDown:{a:5,b:6,c:7,v:1,h:-1},rightUp:{a:1,b:2,c:3,v:-1,h:1},leftUp:{a:7,b:0,c:1,v:-1,h:-1}};function v(e,t){e.jFlag|=1<<t}function j(e,t,s,i){let n=i,r=B(e,t,s),h=0;if(r[n.e])return{dst:0,isJump:!1};for(;;){if(h++,r=B(e,t+n.h*h,s+n.v*h),r[n.a]&&!r[n.b]||r[n.c]&&!r[n.d])return{dst:h,isJump:!0};if(r[n.e])return{dst:h,isJump:!1}}}function S(e,t,s,i,n){let r=n,h=B(e,s,i),u=0;if(h[r.a]||h[r.b]||h[r.c])return{dst:0,isJump:!1};for(;;){u++,h=B(e,s+r.h*u,i+r.v*u);let l=t[i+r.v*u][s+r.h*u].jump;if((h[r.a]||h[r.b]||h[r.c])&&!l)return{dst:u,isJump:!1};let o=t[i+r.v*u][s+r.h*u].distances;if(l&&(o[r.a]||o[r.c]))return{dst:u,isJump:!0}}}function E(e,t,s,i){let n=e[i][s],r=j(t,s,i,D.up),h=j(t,s,i,D.down),u=j(t,s,i,D.left),l=j(t,s,i,D.right);n.distances[1]=r.dst,n.distances[3]=l.dst,n.distances[5]=h.dst,n.distances[7]=u.dst,r.isJump&&v(n,1),l.isJump&&v(n,3),h.isJump&&v(n,5),u.isJump&&v(n,7)}function H(e,t,s,i){let n=e[i][s],r=S(t,e,s,i,P.leftUp),h=S(t,e,s,i,P.rightUp),u=S(t,e,s,i,P.rightDown),l=S(t,e,s,i,P.leftDown);n.distances[0]=r.dst,n.distances[2]=h.dst,n.distances[4]=u.dst,n.distances[6]=l.dst,r.isJump&&v(n,0),h.isJump&&v(n,2),u.isJump&&v(n,4),l.isJump&&v(n,6)}function X(e,t){return{x:e,y:t,parent:null,distances:[],jFlag:0,jump:!1,inOpen:!1,inClose:!1,g:0,f:0,hash:0}}function w(e,t){return(e.jFlag&1<<t)!=0}function _(e){let t=e.length,s=e[0].length,i=[];for(let n=0;n<t;n++){let r=new Array(s).fill(0);r.forEach((h,u)=>{r[u]=e[n][u]?0:X(u,n)}),i.push(r)}for(let n=0;n<t;n++)i[n].forEach((h,u)=>{if(!h)return;E(i,e,u,n);let l=i[n][u].distances,o=i[n][u].jFlag;l[1]&&w(h,1)&&(i[n-l[1]][u].jump=!0),l[3]&&w(h,3)&&(i[n][u+l[3]].jump=!0),l[5]&&w(h,5)&&(i[n+l[5]][u].jump=!0),l[7]&&w(h,7)&&(i[n][u-l[7]].jump=!0)});for(let n=0;n<t;n++)i[n].forEach((h,u)=>{h&&H(i,e,u,n)});return i}var k=class{constructor(t){this.items=[],this.prop=t}push(t){if(!this.items.length){t.inOpen=!0,this.items.push(t);return}for(let s=this.items.length-1;s>=0;s--)if(this.items[s][this.prop]>=t[this.prop]){this.items.splice(s+1,0,t);return}this.items.unshift(t)}},A=class{constructor(t,s,i){let n=[];for(let r=0;r<i;r++)n.push(new k(t));this.heaps=n,this.prop=t,this.range=s,this.count=0}addHeaps(t){for(let s=0;s<t;s++)this.heaps.push(new k(this.prop))}push(t){this.count++;let s=t[this.prop]/this.range|0;s>this.heaps.length-1&&this.addHeaps(s-(this.heaps.length-1)),this.heaps[s].push(t)}pop(){if(this.count--,this.count<0)return this.count=0,null;for(let t=0;t<this.heaps.length;t++)if(this.heaps[t].items.length)return this.heaps[t].items.pop()}};var O=0,R=[[7,0,1],[7,0,1,2,3],[1,2,3],[1,2,3,4,5],[3,4,5],[3,4,5,6,7],[5,6,7],[5,6,7,0,1]],I=[{v:-1,h:-1},{v:-1,h:0},{v:-1,h:1},{v:0,h:1},{v:1,h:1},{v:1,h:0},{v:1,h:-1},{v:0,h:-1}],Y=[0,1,2,7,null,3,6,5,4];function F(e){let t=[],s=e,i=0;for(;s;)t[i++]={x:s.x,y:s.y},s=s.parent;return t.reverse()}function U(e,t,s){let i=Math.abs(e.x-t),n=Math.abs(e.y-s);return 10*(i+n)-5.857*Math.min(i,n)|0}function Z(e,t){let s=t.x-e.x,i=t.y-e.y;if(s<0){if(i<0)return 0;if(i==0)return 7;if(i>0)return 6}if(s==0){if(i<0)return 1;if(i>0)return 5}if(s>0){if(i<0)return 2;if(i==0)return 3;if(i>0)return 4}}function q(e,t,s,i){let n=I[i];return e[t.y+n.v*s][t.x+n.h*s]}function $(e,t,s){let i=Math.sign(t.x-e.x),n=Math.sign(t.y-e.y);return Y[4+i+3*n]==s}function N(e,t,s,i){let n=t.x,r=t.y;return!!($(e,t,s)&&i>=Math.abs(e.x-n)&&i>=Math.abs(e.y-r))}function G(e,t){e.hash=t,e.parent=null,e.inOpen=!1,e.inClose=!1,e.g=0,e.f=0}function Q(e,t,s,i,n,r,h){let u=q(e,t,n,r);u.hash!=O&&G(u,O);let l=i.g+h*Math.SQRT2,o=l+n,b=!0;return(u.inClose||u.inOpen&&u.g<=o||t.inOpen&&t.g<=l)&&(b=!1),b?(t.parent=i,t.g=l,t.inOpen=!0,u.parent=t,u.g=o,u.f=o+U(u,s.x,s.y),u.inOpen?null:u):null}function K(e,t,s,i,n){if(!e[s][t]||!e[n][i])return null;let r=[0,1,2,3,4,5,6,7],h=e[n][i],u=new A("f",100,10);O++;let l=e[s][t];for(G(l,O),u.push(l);u.count;){let o=u.pop();if(o.inOpen=!1,o.inClose=!0,o.x==i&&o.y==n)return F(o);let b=o.parent?R[Z(o.parent,o)]:r;for(let C=0;C<b.length;C++){let p=b[C],M=I[p],d=o.distances[p];if(d){if(N(o,h,p,d))return h.parent=o,F(h);if(p%2==0){let c=R[p][0],g=R[p][2];for(let m=1;m<=d;m++){let f=e[o.y+M.v*m][o.x+M.h*m],T=f.distances[c],z=f.distances[g];if(f.hash!=O&&G(f,O),m==d&&f.jump){let a=o.g+m*Math.SQRT2;if(f.inClose||f.inOpen&&f.g<=a)continue;f.parent=o,f.g=a,f.f=a+U(f,i,n),f.inOpen||(f.inOpen=!0,f.inClose=!1,u.push(f));continue}if(T){if(N(f,h,c,T))return f.parent=o,h.parent=f,F(h);if(w(f,c)){let a=Q(e,f,h,o,T,c,m);a&&(a.inOpen=!0,a.inClose=!1,u.push(a))}}if(z){if(N(f,h,g,z))return f.parent=o,h.parent=f,F(h);if(w(f,g)){let a=Q(e,f,h,o,z,g,m);a&&(a.inOpen=!0,a.inClose=!1,u.push(a))}}}}if(p%2!=0&&w(o,p)){let c=q(e,o,d,p);c.hash!=O&&G(c,O);let g=o.g+d;if(c.inClose||c.inOpen&&c.g<=g)continue;c.parent=o,c.g=g,c.f=g+U(c,i,n),c.inOpen||(c.inOpen=!0,c.inClose=!1,u.push(c))}}}}return null}var J=new Map,L=1e3;function x(e,t,s,i,n){J.size>L&&J.delete(J.keys().next().value);let r=t+"."+s+"."+i+"."+n;J.set(r,e)}function V(e,t,s,i,n){if(!e[s][t]||!e[n][i])return null;let r=J.get(t+"."+s+"."+i+"."+n);return r!==void 0||(r=getPath(e,t,s,i,n),x(r,t,s,i,n)),r}function W(e){L=e}typeof window<"u"&&(globalThis.Pfinder={getPath:K,getPathFromCache:V,makeGrid:_,setMaxCacheSize:W});})();
/**
* @copyright    2023 Juan Jose Capellan
* @license      {@link https://github.com/jjcapellan/pfinder/blob/master/LICENSE | MIT License}
*/
